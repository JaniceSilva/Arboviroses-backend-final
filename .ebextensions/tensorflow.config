# .ebextensions/tensorflow.config

# 1. Configurações de Otimização do TensorFlow
option_settings:
  aws:elasticbeanstalk:application:environment:
    TF_CPP_MIN_LOG_LEVEL: "1"  # Reduz logs do TensorFlow (0=todos, 1=apenas erros)
    OMP_NUM_THREADS: "1"        # Otimização para instâncias pequenas

# 2. Instalação de Dependências do Sistema
packages:
  yum:
    atlas-devel: []             # BLAS/LAPACK
    libgfortran: []             # Suporte Fortran
    libjpeg-turbo-devel: []     # Processamento de imagem

# 3. Configuração de Swap (1GB)
commands:
  01_create_swap:
    command: |
      if [ ! -f /swapfile ]; then
        dd if=/dev/zero of=/swapfile bs=1M count=1024
        chmod 600 /swapfile
        mkswap /swapfile
        swapon /swapfile
        echo '/swapfile none swap sw 0 0' >> /etc/fstab
      fi

# 4. Pré-instalação de Pacotes Python (opcional)
container_commands:
  01_install_build_deps:
    command: |
      sudo pip install --upgrade pip
      sudo pip install wheel setuptools --no-cache-dir

# 5. Configuração de Limites do Sistema
files:
  "/etc/security/limits.d/tensorflow.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      * soft memlock unlimited
      * hard memlock unlimited
      * soft stack 65536
      * hard stack 65536